@{
    ViewData["Title"] = "後台統計圖表";
}

<h2>後台儀表板</h2>

<canvas id="ordersChart" width="600" height="300"></canvas>
<canvas id="revenueChart" width="600" height="300" class="mt-5"></canvas>
<canvas id="statusChart" width="600" height="300" class="mt-5"></canvas>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        async function loadCharts() {
            const res = await fetch('/api/admin/dashboard/charts');
            const data = await res.json();

            const ordersChart = new Chart(document.getElementById('ordersChart'), {
                type: 'line',
                data: {
                    labels: data.dailyOrderCounts.map(d => d.date),
                    datasets: [{
                        label: '每日訂單數',
                        data: data.dailyOrderCounts.map(d => d.count),
                        borderWidth: 2,
                        fill: false,
                        borderColor: 'blue'
                    }]
                }
            });

            const revenueChart = new Chart(document.getElementById('revenueChart'), {
                type: 'bar',
                data: {
                    labels: data.dailyRevenue.map(d => d.date),
                    datasets: [{
                        label: '每日營收',
                        data: data.dailyRevenue.map(d => d.amount),
                        backgroundColor: 'green'
                    }]
                }
            });

            const statusChart = new Chart(document.getElementById('statusChart'), {
                type: 'pie',
                data: {
                    labels: data.statusDistribution.map(d => d.status),
                    datasets: [{
                        label: '訂單狀態分布',
                        data: data.statusDistribution.map(d => d.count),
                        backgroundColor: ['red', 'orange', 'blue', 'gray']
                    }]
                }
            });
        }

        loadCharts();
    </script>
}
