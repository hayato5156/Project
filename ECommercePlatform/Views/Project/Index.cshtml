@{
    ViewData["Title"] = "å•†å“è©•åƒ¹";
    var messages = ViewBag.messages as List<ECommercePlatform.Models.Messages>;
    string selectedSort = Context.Request.Query["sort"];
    string selectedScore = Context.Request.Query["scoreFilter"];
    string keyword = Context.Request.Query["keyword"];
}

<h2 class="mb-3">ğŸ“‹ å•†å“è©•åƒ¹åˆ—è¡¨</h2>

<p class="text-muted">
    ğŸ“ ç¸½ç•™è¨€æ•¸ï¼š<strong>@ViewBag.totalMessages</strong> |
    â­ å¹³å‡è©•åˆ†ï¼š<strong>@ViewBag.averageScore.ToString("0.0")</strong>
</p>

<form method="get" asp-controller="Project" asp-action="Index" class="row g-3 mb-4">
    <input type="hidden" name="ID" value="@ViewBag.ID" />
    <input type="hidden" name="userName" value="@ViewBag.name" />
    <input type="hidden" name="buyOrSell" value="@ViewBag.identity" />

    <div class="col-md-3">
        <label class="form-label">æ’åºæ–¹å¼</label>
        <select name="sort" class="form-select">
            <option value="latest" selected="@(selectedSort == "latest")">æœ€æ–°</option>
            <option value="oldest" selected="@(selectedSort == "oldest")">æœ€èˆŠ</option>
            <option value="highscore" selected="@(selectedSort == "highscore")">è©•åˆ†é«˜â†’ä½</option>
            <option value="lowscore" selected="@(selectedSort == "lowscore")">è©•åˆ†ä½â†’é«˜</option>
        </select>
    </div>

    <div class="col-md-3">
        <label class="form-label">è©•åˆ†éæ¿¾</label>
        <select name="scoreFilter" class="form-select">
            <option value="">--å…¨éƒ¨--</option>
            @for (int i = 5; i >= 1; i--)
            {
                <option value="@i" selected="@(selectedScore == i.ToString())">@i æ˜Ÿ</option>
            }
        </select>
    </div>

    <div class="col-md-4">
        <label class="form-label">é—œéµå­—æœå°‹</label>
        <input type="text" name="keyword" class="form-control" placeholder="è«‹è¼¸å…¥ç•™è¨€å…§å®¹" value="@keyword" />
    </div>

    <div class="col-md-2 align-self-end">
        <button type="submit" class="btn btn-primary w-100">ğŸ” ç¯©é¸</button>
    </div>
</form>

<div id="messageResult" class="row">
    @if (messages != null && messages.Any())
    {
        foreach (var m in messages)
        {
            <div class="col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-light">
                        <strong>@m.userName</strong>
                        <span class="text-warning float-end">
                            @{
                                for (int s = 1; s <= 5; s++)
                                {
                                    if (s <= m.score)
                                    {
                                        <text>â˜…</text>
                                        ;
                                    }
                                    else
                                    {
                                        <text>â˜†</text>
                                        ;
                                    }
                                }
                            }
                        </span>
                    </div>
                    <div class="card-body">
                        <p>@m.main</p>
                        @if (m.imageData != null)
                        {
                            <img src="data:image/png;base64,@Convert.ToBase64String(m.imageData)" class="img-fluid rounded" alt="ç•™è¨€åœ–ç‰‡" />
                        }
                    </div>
                    <div class="card-footer small text-muted">
                        è©•åƒ¹æ™‚é–“ï¼š@m.date.ToString("yyyy-MM-dd HH:mm")
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div class="col-12">
            <p class="text-center text-muted">ç›®å‰æ²’æœ‰åˆé©çš„ç•™è¨€ã€‚</p>
        </div>
    }
</div>
